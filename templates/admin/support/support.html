{% extends "admin/admin_layout.html" %}

{% block content %}
<!-- DANH S√ÅCH T√ÄI LI·ªÜU -->
<div class="mb-10">
    <!-- Header -->
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-bold text-green-700">üìö Danh s√°ch t√†i li·ªáu</h2>
        <button
            onclick="openTaiLieuModal()"
            class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 shadow"
        >
            ‚ûï Th√™m t√†i li·ªáu
        </button>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto rounded-lg shadow border border-gray-200 h-[65vh] overflow-y-auto">
        <table class="min-w-full text-sm text-gray-800">
            <thead class="bg-green-100 text-gray-700 text-left sticky top-0 z-10">
                <tr>
                    <th class="px-4 py-3 border text-center">#</th>
                    <th class="px-4 py-3 border">Ti√™u ƒë·ªÅ</th>
                    <th class="px-4 py-3 border">M√¥ t·∫£</th>
                    <th class="px-4 py-3 border">Lo·∫°i t√†i li·ªáu</th>
                    <th class="px-4 py-3 border">Ng√†y c·∫≠p nh·∫≠t</th>
                    <th class="px-4 py-3 border">Doanh nghi·ªáp</th>
                    <th class="px-4 py-3 border">File</th>
                    <th class="px-4 py-3 border text-center">H√†nh ƒë·ªông</th>
                </tr>
            </thead>
            <tbody>
                {% for tl in tailieus %}
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3 border text-center">{{ tl.MA_TL }}</td>
                    <td class="px-4 py-3 border">{{ tl.TIEU_DE_TL }}</td>
                    <td class="px-4 py-3 border">{{ tl.MO_TA_TL|truncatechars:80 }}</td>
                    <td class="px-4 py-3 border">{{ tl.LOAI_TAI_LIEU }}</td>
                    <td class="px-4 py-3 border">{{ tl.NGAY_CAP_NHAT|date:"d-m-y" }}</td>
                    <td class="px-4 py-3 border">{{ tl.MA_DN.TEN_DN }}</td>
                    <td class="px-4 py-3 border">
                        <a href="{{ tl.DUONG_DAN_FILE }}" target="_blank" class="text-green-600 underline">Xem</a>
                    </td>
                    <td class="px-4 py-3 border text-center">
                        <div class="flex flex-col items-center space-y-2">
                            <button
                                class="bg-yellow-400 text-white px-3 py-1 rounded hover:bg-yellow-500 text-xs w-20"
                                onclick="openTaiLieuModal({
                                    ma_tl: '{{ tl.MA_TL }}',
                                    tieu_de_tl: '{{ tl.TIEU_DE_TL|escapejs }}',
                                    mo_ta_tl: '{{ tl.MO_TA_TL|escapejs }}',
                                    loai_tai_lieu: '{{ tl.LOAI_TAI_LIEU|escapejs }}',
                                    duong_dan_file: '{{ tl.DUONG_DAN_FILE|escapejs }}',
                                    ngay_cap_nhat: '{{ tl.NGAY_CAP_NHAT|date:"Y-m-d" }}', <!-- Chuy·ªÉn ƒë·ªãnh d·∫°ng ng√†y -->
                                    ma_dn: '{{ tl.MA_DN.MA_DN }}'
                                })"
                            >
                                ‚úèÔ∏è S·ª≠a
                            </button>

                            <form
                                method="POST"
                                action="{% url 'admin_support:xoa_tailieu' tl.MA_TL %}"
                                onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t√†i li·ªáu n√†y?');"
                            >
                                {% csrf_token %}
                                <button
                                    type="submit"
                                    class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-xs w-20"
                                >
                                    üóëÔ∏è X√≥a
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="text-center py-3 italic text-gray-500">
                        Kh√¥ng c√≥ t√†i li·ªáu n√†o ƒë∆∞·ª£c t√¨m th·∫•y.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% comment %} <!-- Ph√¢n trang n·∫øu c·∫ßn -->
    <div class="mt-4 flex justify-center">
        <div class="inline-flex rounded-md shadow-sm">
            {% if tailieus.has_previous %}
                <a href="?page=1" class="px-4 py-2 text-sm font-medium text-green-600 border border-gray-300 rounded-l-lg">ƒê·∫ßu</a>
                <a href="?page={{ tailieus.previous_page_number }}" class="px-4 py-2 text-sm font-medium text-green-600 border border-gray-300">Tr∆∞·ªõc</a>
            {% endif %}
            <span class="px-4 py-2 text-sm font-medium text-gray-700 border border-gray-300">Trang {{ tailieus.number }} / {{ tailieus.paginator.num_pages }}</span>
            {% if tailieus.has_next %}
                <a href="?page={{ tailieus.next_page_number }}" class="px-4 py-2 text-sm font-medium text-green-600 border border-gray-300">Ti·∫øp theo</a>
                <a href="?page={{ tailieus.paginator.num_pages }}" class="px-4 py-2 text-sm font-medium text-green-600 border border-gray-300 rounded-r-lg">Cu·ªëi</a>
            {% endif %}
        </div>
    </div> {% endcomment %}
</div>

<!-- Modal th√™m/s·ª≠a t√†i li·ªáu -->
{% include "admin/support/themsuatailieu.html" %}

{% endblock %}
