{% load custom_filters %}

<!-- DANH S√ÅCH ƒê·∫∂C S·∫¢N -->
<div class="mb-10">
  <!-- Header -->
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-2xl font-bold text-green-700">üç± Danh s√°ch ƒë·∫∑c s·∫£n</h2>
    <button
      onclick="openDacSanModal()"
      class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 shadow"
    >
      ‚ûï Th√™m ƒë·∫∑c s·∫£n
    </button>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto rounded-lg shadow border border-gray-200 h-[65vh] overflow-y-auto">
    <table class="min-w-full text-sm text-gray-800">
      <thead class="bg-green-100 text-gray-700 text-left sticky top-0 z-10">
        <tr>
          <th class="px-4 py-3 border text-center">#</th>
          <th class="px-4 py-3 border">T√™n ƒë·∫∑c s·∫£n</th>
          <th class="px-4 py-3 border">ƒê·ªãa ƒëi·ªÉm</th>
          <th class="px-4 py-3 border">M√¥ t·∫£</th>
          <th class="px-4 py-3 border">H√¨nh ·∫£nh</th>
          <th class="px-4 py-3 border text-center">H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
        {% for dac_san in dac_sans %}
        <tr class="hover:bg-gray-50">
          <td class="px-4 py-3 border text-center">{{ dac_san.MA_DS }}</td>
          <td class="px-4 py-3 border">{{ dac_san.TEN_DAC_SAN }}</td>
          <td class="px-4 py-3 border">{{ dac_san.MA_DD.TEN_DIA_DIEM }}</td>
          <td class="px-4 py-3 border">{{ dac_san.MO_TA_DS }}</td>
          <td class="px-4 py-3 border">
            {% if dac_san.image_list %}
              <div id="carousel-{{ dac_san.MA_DS }}" class="relative">
                <!-- Carousel -->
                <div class="carousel-container">
                  <div class="carousel-images" style="display: none;"> <!-- ·∫®n ·∫£nh nh∆∞ng v·∫´n gi·ªØ trong DOM -->
                    {% for img in dac_san.image_list %}
                      <img
                        src="{{ img }}"
                        alt="·∫¢nh {{ dac_san.TEN_DAC_SAN }}"
                        class="w-20 h-14 object-cover rounded shadow cursor-pointer"
                        onclick="openCarousel({{ dac_san.MA_DS }})"
                      />
                    {% endfor %}
                  </div>
                </div>
                <!-- N√∫t xem ·∫£nh l·ªõn v√† s·ªë l∆∞·ª£ng ·∫£nh -->
                <div class="flex items-center justify-between mt-2">
                  <button
                    class="text-blue-600 text-xs hover:underline"
                    onclick="openCarousel({{ dac_san.MA_DS }})"
                  >
                    üì∏ Xem ·∫£nh
                  </button>
                  <span class="text-gray-500 text-xs">
                    ({{ dac_san.image_list|length }} ·∫£nh)
                  </span>
                </div>
              </div>
            {% else %}
              <span class="italic text-gray-400">Kh√¥ng c√≥ h√¨nh</span>
            {% endif %}
          </td>
          
          <td class="px-4 py-3 border text-center">
            <div class="flex flex-col items-center space-y-2">
              <button
                class="bg-yellow-400 text-white px-3 py-1 rounded hover:bg-yellow-500 text-xs w-20"
                onclick="openDacSanModal({
                    ma_ds: '{{ dac_san.MA_DS }}',
                    ten: '{{ dac_san.TEN_DAC_SAN|escapejs }}',
                    ma_dd: '{{ dac_san.MA_DD.MA_DD }}',
                    mo_ta: `{{ dac_san.MO_TA_DS|escapejs }}`
                  })"
              >
                ‚úèÔ∏è S·ª≠a
              </button>

              <form
                method="POST"
                action="{% url 'admin_tourism:xoa_dac_san' dac_san.MA_DS %}"
                onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ƒë·∫∑c s·∫£n n√†y?');"
              >
                {% csrf_token %}
                <button
                  type="submit"
                  class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-xs w-20"
                >
                  üóëÔ∏è X√≥a
                </button>
              </form>
            </div>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-center py-3 italic text-gray-500">
            Kh√¥ng c√≥ ƒë·∫∑c s·∫£n n√†o ƒë∆∞·ª£c t√¨m th·∫•y.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div id="carouselModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden" >
  <div class="bg-white rounded-lg p-4 max-w-3xl w-full relative h-auto flex flex-col justify-center items-center">
    <!-- N√∫t ƒë√≥ng modal -->
    <button
      onclick="closeCarousel()"
      class="absolute top-4 right-4 text-gray-600 hover:text-red-600 text-3xl font-bold z-20"
    >
      &times;
    </button>

    <!-- Carousel container for showing all images -->
    <div id="carouselImages" class="flex justify-center items-center w-full h-full overflow-auto">
      <!-- C√°c h√¨nh ·∫£nh v√† th√¥ng tin s·∫Ω ƒë∆∞·ª£c th√™m v√†o b·∫±ng JS -->
    </div>

    <!-- Image count and file name -->
    <div id="imageCount" class="mt-4 text-center text-lg font-semibold z-10">
      <!-- S·ªë l∆∞·ª£ng ·∫£nh s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
    </div>

    <!-- Left and Right arrows -->
    <div class="absolute bottom-4 left-0 right-0 px-8 flex justify-between">
      <button
        onclick="prevImage()"
        class="text-white text-3xl bg-black bg-opacity-50 p-2 rounded-full hover:bg-opacity-70 z-10"
      >
        &#10094;
      </button>
      <button
        onclick="nextImage()"
        class="text-white text-3xl bg-black bg-opacity-50 p-2 rounded-full hover:bg-opacity-70 z-10"
      >
        &#10095;
      </button>
    </div>
  </div>
</div>

<!-- Modal th√™m/s·ª≠a ƒë·∫Øc s·∫£n -->
{% include "admin/tourism/dacsan/themsuadacsan.html" %}