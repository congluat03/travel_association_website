<!-- MODAL TH√äM / S·ª¨A NG∆Ø·ªúI D√ôNG -->
<div id="nguoiDungModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-40 flex items-center justify-center">
  <div class="bg-white w-full max-w-3xl rounded-xl shadow-lg p-6 relative">
    <!-- N√∫t ƒë√≥ng -->
    <button onclick="closeTaiKhoanModal()" class="absolute top-3 right-3 text-gray-400 hover:text-red-500 text-2xl font-bold">
      &times;
    </button>

    <h2 id="form-title" class="text-2xl font-semibold text-green-700 mb-6">
      üë§ Th√™m / S·ª≠a ng∆∞·ªùi d√πng
    </h2>

    <form method="POST" id="form_taikhoan"
      action="{% if taikhoan and taikhoan.MA_TK %}{% url 'admin_members:sua_tai_khoan' taikhoan.MA_TK %}{% else %}{% url 'admin_members:them_tai_khoan' %}{% endif %}"
      enctype="multipart/form-data">
      {% csrf_token %}

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- T√™n ƒëƒÉng nh·∫≠p -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">T√™n ƒëƒÉng nh·∫≠p</label>
          <input
            type="text"
            name="TEN_DANG_NHAP"
            value="{% if taikhoan %}{{ taikhoan.TEN_DANG_NHAP }}{% endif %}"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-green-600 focus:border-green-600"
            placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p"
            required />
        </div>

        <!-- Email ng∆∞·ªùi d√πng -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Email ng∆∞·ªùi d√πng</label>
          <input
            type="email"
            name="EMAIL_TK"
            value="{% if taikhoan %}{{ taikhoan.EMAIL_TK }}{% endif %}"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-green-600 focus:border-green-600"
            placeholder="Nh·∫≠p email"
            required />
        </div>

        <!-- M·∫≠t kh·∫©u -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">M·∫≠t kh·∫©u</label>
          <input
            type="password"
            name="MAT_KHAU"
            value="{% if taikhoan %}{{ taikhoan.MAT_KHAU }}{% endif %}"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-green-600 focus:border-green-600"
            placeholder="Nh·∫≠p m·∫≠t kh·∫©u"
            required />
        </div>

        <!-- Vai tr√≤ (dropdown) -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Vai tr√≤</label>
          <select
            name="VAI_TRO"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-green-600 focus:border-green-600"
            required>
            <option value="">Ch·ªçn vai tr√≤</option>
            <option value="admin" {% if taikhoan and taikhoan.VAI_TRO == 'admin' %}selected{% endif %}>Admin</option>
            <option value="nhanvien" {% if taikhoan and taikhoan.VAI_TRO == 'nhanvien' %}selected{% endif %}>Nh√¢n vi√™n</option>
            <option value="nguoidung" {% if taikhoan and taikhoan.VAI_TRO == 'nguoidung' %}selected{% endif %}>Ng∆∞·ªùi d√πng</option>
          </select>
        </div>

        <!-- Tr·∫°ng th√°i t√†i kho·∫£n -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Tr·∫°ng th√°i t√†i kho·∫£n</label>
          <select
            name="TRANG_THAI_TK"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-green-600 focus:border-green-600"
            required>
            <option value="1" {% if taikhoan and taikhoan.TRANG_THAI_TK == 1 %}selected{% endif %}>Ho·∫°t ƒë·ªông</option>
            <option value="0" {% if taikhoan and taikhoan.TRANG_THAI_TK == 0 %}selected{% endif %}>Kh√≥a</option>
          </select>
        </div>

        <!-- Doanh nghi·ªáp -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Doanh nghi·ªáp</label>
          <select name="MA_DN" id="MA_DN"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-green-600 focus:border-green-600" required>
            <option value="">Ch·ªçn doanh nghi·ªáp</option>
            {% for dn in doanhnghiep %}
              <option value="{{ dn.MA_DN }}" {% if taikhoan and taikhoan.MA_DN.MA_DN == dn.MA_DN %}selected{% endif %}>
                {{ dn.TEN_DN }}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- Ch·ªçn ·∫£nh -->
        <div class="flex items-center space-x-4">
          <div class="w-full">
            <label class="block text-sm font-medium text-gray-700 mb-1">Ch·ªçn ·∫£nh ƒë·∫°i di·ªán</label>
            <input
              type="file"
              name="ANH_DAI_DIEN"
              accept="image/*"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-green-600 focus:border-green-600"
              onchange="previewImageTK(event)" />
          </div>
          <div id="imagePreview" class="w-24 h-24 border-2 border-gray-300 rounded-lg overflow-hidden">
            {% if taikhoan and taikhoan.ANH_DAI_DIEN %}
              <img id="previewImg" src="{{ taikhoan.ANH_DAI_DIEN.url }}" alt="H√¨nh ·∫£nh ƒë·∫°i di·ªán"
                class="w-full h-full object-cover" />
            {% else %}
              <!-- Kh√¥ng c√≥ ·∫£nh th√¨ ·∫©n -->
              <img id="previewImg" src="#" alt="H√¨nh ·∫£nh ƒë·∫°i di·ªán" class="w-full h-full object-cover hidden" />
            {% endif %}
          </div>
        </div>

      <!-- N√∫t L∆∞u -->
      <div class="text-right pt-4">
        <button id="submit-button" type="submit"
          class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg shadow-md">
          üíæ L∆∞u ng∆∞·ªùi d√πng
        </button>
      </div>
    </form>
  </div>
</div>

<!-- JS Xem ·∫£nh -->
<script>
  function previewImageTK(event) {
    const file = event.target.files[0];
    const reader = new FileReader();
    reader.onload = function (e) {
      const img = document.getElementById('previewImg');
      img.src = e.target.result;
      img.classList.remove('hidden');
    }
    if (file) {
      reader.readAsDataURL(file);
    }
  }
  
</script>
