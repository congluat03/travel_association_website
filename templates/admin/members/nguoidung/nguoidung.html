<!-- DANH S√ÅCH T√ÄI KHO·∫¢N -->
<div class="mb-10">
  <!-- Header -->
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-2xl font-semibold text-green-700">üë§ Danh s√°ch t√†i kho·∫£n</h2>
    <button
      onclick="openTaiKhoanModal()"
      class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 shadow"
    >
      ‚ûï Th√™m t√†i kho·∫£n
    </button>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto rounded-lg shadow-md border border-gray-200 h-[65vh] overflow-y-auto bg-white">
    <table class="min-w-full text-sm text-gray-800">
      <thead class="bg-green-100 text-gray-700 text-left sticky top-0 z-10">
        <tr>
          <th class="px-4 py-3 border text-center">STT</th>
          <th class="px-4 py-3 border">T√™n ƒëƒÉng nh·∫≠p</th>
          <th class="px-4 py-3 border">Email</th>
          <th class="px-4 py-3 border">M·∫≠t kh·∫©u</th>
          <th class="px-4 py-3 border">T√™n doanh nghi·ªáp</th>
          <th class="px-4 py-3 border">Vai tr√≤</th>
          <th class="px-4 py-3 border">Tr·∫°ng th√°i</th>
          <th class="px-4 py-3 border text-center">H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
        {% for taikhoan in taikhoan %}
        <tr class="hover:bg-gray-50">
          <td class="px-4 py-3 border text-center">{{ taikhoan.MA_TK }}</td>
          <td class="px-4 py-3 border">{{ taikhoan.TEN_DANG_NHAP }}</td>
          <td class="px-4 py-3 border">{{ taikhoan.EMAIL_TK }}</td>
                    <!-- Th√™m c·ªôt M·∫≠t kh·∫©u trong <tbody> -->
          <td class="px-4 py-3 border">
            {{ taikhoan.MAT_KHAU|default:"-" }}
          </td>
          <td class="px-4 py-3 border">
            {{ taikhoan.MA_DN.TEN_DN|default:"-" }}
          </td>          
          <td class="px-4 py-3 border">{{ taikhoan.VAI_TRO }}</td>
          <td class="px-4 py-2">
            {% if taikhoan.TRANG_THAI_TK %}
            <span class="text-green-500 font-semibold">Ho·∫°t ƒë·ªông</span>
            {% else %}
            <span class="text-red-500 font-semibold">Kh√≥a</span>
            {% endif %}
          </td>

          <td class="px-4 py-3 border text-center">
            <div class="flex flex-col items-center space-y-2">
              <button
              class="bg-yellow-400 text-white px-3 py-1 rounded hover:bg-yellow-500 text-xs w-20"
              onclick="openTaiKhoanModal({
                ma_tk: '{{ taikhoan.MA_TK }}',
                ten_dang_nhap: '{{ taikhoan.TEN_DANG_NHAP|escapejs }}',
                email: '{{ taikhoan.EMAIL_TK|escapejs }}',
                vai_tro: '{{ taikhoan.VAI_TRO|escapejs }}',
                trang_thai: '{{ taikhoan.TRANG_THAI_TK }}',
                mat_khau: '{{ taikhoan.MAT_KHAU|escapejs }}'
              })"
            >
              ‚úèÔ∏è S·ª≠a
            </button>
            

              <form
                method="POST"
                action="{% url 'admin_members:xoa_tai_khoan' taikhoan.MA_TK %}"
                onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t√†i kho·∫£n n√†y?');"
              >
                {% csrf_token %}
                <button
                  type="submit"
                  class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-xs w-20"
                >
                  üóëÔ∏è X√≥a
                </button>
              </form>
            </div>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-center py-3 italic text-gray-500">
            Kh√¥ng c√≥ t√†i kho·∫£n n√†o ƒë∆∞·ª£c t√¨m th·∫•y.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<script>
    function openTaiKhoanModal(data = null) {
      const modal = document.getElementById('nguoiDungModal');
      modal.classList.remove('hidden');
  
      if (data) {
        document.getElementById('form-title').innerText = 'C·∫≠p nh·∫≠t t√†i kho·∫£n';
        document.getElementById('submit-button').value = 'C·∫≠p nh·∫≠t';
  
        document.getElementById('TEN_DANG_NHAP').value = data.ten_dang_nhap || '';
        document.getElementById('EMAIL_TK').value = data.email || '';
        document.getElementById('MAT_KHAU').value = data.mat_khau || '';
        document.getElementById('VAI_TRO').value = data.vai_tro || '';
        document.getElementById('TRANG_THAI_TK').value = data.trang_thai === 'True' ? '1' : '0';
  
        // N·∫øu c√≥ m√£ doanh nghi·ªáp
        if (data.ma_dn) {
          document.getElementById('MA_DN').value = data.ma_dn;
        }
  
        // N·∫øu b·∫°n c√≥ th√™m tr∆∞·ªùng ng√†y ƒëƒÉng k√Ω (n·∫øu c·∫ßn)
        if (data.ngay_dang_ky) {
          document.getElementById('NGAY_DANG_KY_TK').value = data.ngay_dang_ky;
        }
  
      } else {
        document.getElementById('form-title').innerText = 'Th√™m t√†i kho·∫£n m·ªõi';
        document.getElementById('submit-button').value = 'Th√™m m·ªõi';
  
        document.getElementById('TEN_DANG_NHAP').value = '';
        document.getElementById('EMAIL_TK').value = '';
        document.getElementById('MAT_KHAU').value = data.mat_khau || '';
        document.getElementById('VAI_TRO').value = '';
        document.getElementById('TRANG_THAI_TK').value = '1';
        document.getElementById('NGAY_DANG_KY_TK').value = '';
  
        if (document.getElementById('MA_DN')) {
          document.getElementById('MA_DN').value = '';
        }
      }
    }
  
    function closeTaiKhoanModal() {
      document.getElementById('taiKhoanModal').classList.add('hidden');
    }
     // L·∫•y ng√†y hi·ªán t·∫°i
     const currentDate = new Date().toISOString().split('T')[0];  // ƒê·ªãnh d·∫°ng yyyy-mm-dd
    document.querySelector('input[name="NGAY_DANG_KY_TK"]').value = currentDate;
  </script>
  

{% include "admin/members/nguoidung/themsuanguoidung.html" %}x  
